<!DOCTYPE html>
<html>
  <head>
    <!--Import Google Icon Font-->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <!--Import materialize.css-->
    <link
      rel="stylesheet"
      href="/public/materialize-css/css/materialize.min.css"
      media="screen,projection"
    />

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="http://localhost:35729/livereload.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <form class="col s12" id="loginform">
          <div class="row">
            <div class="input-field col s12">
              <input id="login" type="text" class="validate" />
              <label for="login">Login</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <input id="password" type="password" class="validate" />
              <label for="password">Password</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s6">
              <button
                class="btn waves-effect waves-light"
                type="submit"
                name="action"
              >
                Submit
                <i class="material-icons right">send</i>
              </button>
            </div>
            <div class="input-field col s6">
              <a href="/register">Or register</a>
            </div>
          </div>
        </form>
      </div>
    </div>
    <!--JavaScript at end of body for optimized loading-->
    <script
      type="text/javascript"
      src="/public/materialize-css/js/materialize.min.js"
    ></script>
    <script>
      async function submitFn() {
        const login = document.querySelector("#login").value;
        const password = document.querySelector("#password").value;

        const rawResponse = await fetch("/rest/login", {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            login,
            password
          })
        });

        if ((rawResponse.status = 200)) {
          location.href = "/";
        }

        return false;
      }

      document
        .querySelector("#loginform")
        .addEventListener("submit", async e => {
          e.preventDefault();
          submitFn();
        });
    </script>
  </body>
</html>
